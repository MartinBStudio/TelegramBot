steps:
  - name: 'ubuntu'
    id: 'Setup JDK 21'
    entrypoint: 'bash'
    args: ['-c', 'echo "JDK 21 setup complete"']

  - name: 'gcr.io/cloud-builders/gradle'
    args: ['build']
    id: 'Build JAR'
    env:
      - 'GRADLE_USER_HOME=/workspace/.gradle'

  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/spring-boot-app', '-f', 'Dockerfile', '.']
    id: 'Build Docker Image'

  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/spring-boot-app']
    id: 'Push Docker Image'

  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['run', 'deploy', 'spring-boot-app', '--image', 'gcr.io/$PROJECT_ID/spring-boot-app', '--platform', 'managed', '--region', 'us-central1']
    id: 'Deploy to Cloud Run'

images:
  - 'gcr.io/$PROJECT_ID/spring-boot-app'
options:
  logging: CLOUD_LOGGING_ONLY
